<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="/layout">

<!-- 컨텐츠 영역 -->
	<section id="container" layout:fragment="content">
		<h2 id="pageTit" class="blind" th:text="${#messages.msg('gnb.setting')}" />
		<div class="tabmenu">
			<ul>
				<li class="on"><a href="/setting-account" th:text="${#messages.msg('gnb.setting.account')}" /></li>
				<li><a href="/setting-assign" th:text="${#messages.msg('gnb.setting.assign')}" /></li>
				<li><a href="/setting-rider" th:text="${#messages.msg('gnb.setting.rider')}" /></li>
				<li><a href="/setting-alarm" th:text="${#messages.msg('gnb.setting.alarm')}" /></li>
				<li><a href="/setting-notice" th:text="${#messages.msg('gnb.notice')}" /></li>
			</ul>
		</div>
		<div id="contents">
			<div class="cont_box" >
				<div class="top"><strong th:text="${#messages.msg('gnb.setting.account.store')}" /></div>
				<div class="cont">
					<ul class="form_list">
						<li>
							<strong th:text="${#messages.msg('login.id')}" />
							<div><input type="text" name="" class="input readonly" readonly="readonly" th:value="${store.loginId}"/></div>
						</li>
						<li>
							<strong th:text="${#messages.msg('login.password')}" />
							<div><input type="password" name="" class="input"/></div>
						</li>
						<li>
							<strong th:text="${#messages.msg('store.code')}" />
							<div><input type="text" name="" id="storeId" class="input readonly" readonly="readonly" th:value="${store.code}"/></div>
						</li>
						<li>
							<strong th:text="${#messages.msg('store.name')}" />
							<div><input type="text" name="" id="name" class="input readonly" readonly="readonly" th:value="${store.storeName}"/></div>
						</li>
						<li>
							<strong th:text="${#messages.msg('store.phone')}" />
							<div><input type="text" name="" id="storePhone" class="input" th:value="${store.storePhone}"/></div>
						</li>

						<li>
							<strong th:text="${#messages.msg('store.belong.group')}" />
							<div>
								<select name="" class="select readonly" disabled="disabled">
									<option th:value="${store.group.name}" th:text="${store.group.name}"></option>
								</select>
								<select name="" class="select readonly" disabled="disabled">
									<option th:value="${store.subGroup.name}" th:text="${store.subGroup.name}"></option>
								</select>
							</div>
						</li>
						
						<li>
							<strong th:text="${#messages.msg('store.manager.name')}" />
							<div><input type="text" name="" class="input" id="mangerName" th:value="${store.name}" /></div>
						</li>
						
						<li>
							<strong th:text="${#messages.msg('store.manager.phone')}" />
							<div><input type="text" name="" class="input" id="phone" th:value="${store.phone}"/></div>
						</li>
						
						<li>
							<strong th:text="${#messages.msg('store.address')}" />
							<div><input type="text" name="" id="address" class="input w_100" th:value="${store.address}"/></div>
						</li>
						<li>
							<strong th:text="${#messages.msg('store.address.detail')}" />
							<div><input type="text" name="" id="detailAddress" class="input w_100" th:value="${store.detailAddress}"/></div>
						</li>
					</ul>
				</div>
			</div>
			<div class="button_box">
				<a href="#" class="button btn_blue w120 h30" th:text="${#messages.msg('btn.confirm')}" id="accountUpdate" onclick="javascript:putStoreInfo();"/>
			</div>
		</div>
		<script type="text/javascript" th:src="@{/resources/js/site/setting/setting.js}" layout:fragment="script2"></script>
	</section>
	<!-- //컨텐츠 영역 -->
<script layout:fragment="script" th:inline="javascript">
	/*<![CDATA[*/
    var my_store = /*[[${store}]]*/ 'my_store';
    var my_notice_list = /*[[${noticeList}]]*/ 'my_notice_list';
    var websocket_localhost = /*[[#{websocket.localhost}]]*/ 'websocket_localhost';
    function noticeAlarm() {
        $('#myStoreName').text(my_store.storeName);
        var j = 0;
        console.log(my_notice_list);
        for (var i = 0; i < my_notice_list.length; i++) {
            if (my_notice_list[i].confirmedDatetime == "") {
                j++;
            }
        }
        console.log(j);
        if(j != 0){
            $("#notice_alarm").addClass('new');
        }else{
            $("#notice_alarm").removeClass('new');
        }
    }
    $(document).ready(function() {
        var supportsWebSockets = 'WebSocket' in window || 'MozWebSocket' in window;
        if (supportsWebSockets) {
            var socket = io(websocket_localhost, {
                path: '/socket.io', // 서버 사이드의 path 설정과 동일해야 한다
                transports: ['websocket'] // websocket만을 사용하도록 설정
            });
            socket.on('message', function (data) {
                if (data.match('assign_updated') == 'notice_updated') {
                    location.href = "/setting-account";
                }
                if(data.match('notice_update')=='notice_update'){
                    noticeAlarm();
                }
            });
            $(function () {
                $('#accountUpdate').click(function () {
                    socket.emit('message', "push_data:{type:account_updated, id:"+my_store.id+"}");
                });
            })
        } else {
            alert('websocket을 지원하지 않는 브라우저입니다.');
        }
        noticeAlarm();
    });
    /*]]>*/
</script>
</html>